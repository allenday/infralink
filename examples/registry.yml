# Example Infrastructure Registry
# UUID is the primary key (immutable identity)
# canonical_name is the human-readable identifier (can be renamed)
# Services are first-class objects with port, protocol, exposure

hosts:
  # Database server
  d1b9e5d5-36b0-459d-a556-96622811fbd5:
    canonical_name: prod-database
    status: active
    group: production
    cloud: hetzner-cloud
    tailscale_ip: 100.78.109.111
    tailscale_name: prod-database
    public_ip: 91.99.122.86
    services:
      postgresql:
        port: 5432
        protocol: postgresql
        exposure: internal
      redis:
        port: 6379
        protocol: redis
        exposure: internal
      mariadb:
        port: 3306
        protocol: mysql
        exposure: internal
      node-exporter:
        port: 9100
        protocol: http
        exposure: internal
      postgres-exporter:
        port: 9187
        protocol: http
        exposure: internal
      redis-exporter:
        port: 9121
        protocol: http
        exposure: internal
    observability:
      ready: true
      managed_services:
        - node-exporter
        - postgres-exporter
        - redis-exporter

  # Application server 1
  fa2b9872-d94c-4b20-a73a-57a205560769:
    canonical_name: prod-app-1
    status: active
    group: production
    cloud: hetzner-cloud
    tailscale_ip: 100.69.66.115
    tailscale_name: prod-app-1
    public_ip: 162.55.23.32
    services:
      nginx:
        port: 80
        protocol: http
        exposure: public
      nginx-https:
        port: 443
        protocol: https
        exposure: public
      app-worker:
        port: 8000
        protocol: http
        exposure: internal
        notes: "Gunicorn/uvicorn app server"
      node-exporter:
        port: 9100
        protocol: http
        exposure: internal
      cadvisor:
        port: 8080
        protocol: http
        exposure: internal
    roles:
      app-worker:
        concurrency: 10
    observability:
      ready: true
      managed_services:
        - node-exporter
        - cadvisor

  # Application server 2
  b1a554f8-76ed-4d98-91bb-f0fbfc2818d1:
    canonical_name: prod-app-2
    status: active
    group: production
    cloud: hetzner-cloud
    tailscale_ip: 100.82.220.106
    tailscale_name: prod-app-2
    public_ip: 78.46.72.53
    services:
      nginx:
        port: 80
        protocol: http
        exposure: public
      nginx-https:
        port: 443
        protocol: https
        exposure: public
      app-worker:
        port: 8000
        protocol: http
        exposure: internal
      node-exporter:
        port: 9100
        protocol: http
        exposure: internal
      cadvisor:
        port: 8080
        protocol: http
        exposure: internal
    roles:
      app-worker:
        concurrency: 10
    observability:
      ready: true
      managed_services:
        - node-exporter
        - cadvisor

  # Monitoring server
  97da6b29-9b36-4d78-999d-739e6529f17d:
    canonical_name: monitoring-bastion
    status: active
    group: infrastructure
    cloud: hetzner-cloud
    tailscale_ip: 100.91.20.46
    tailscale_name: monitoring-bastion
    public_ip: 91.99.181.74
    services:
      prometheus:
        port: 9090
        protocol: http
        exposure: internal
        healthcheck_path: /-/healthy
      grafana:
        port: 3000
        protocol: http
        exposure: internal
        healthcheck_path: /api/health
      otel-collector:
        port: 4317
        protocol: grpc
        exposure: internal
        notes: "OTLP gRPC receiver"
      node-exporter:
        port: 9100
        protocol: http
        exposure: internal
    observability:
      ready: true
      managed_services:
        - node-exporter

  # Staging database (terminated)
  e1a2b3c4-d5e6-4f7a-8b9c-0d1e2f3a4b5c:
    canonical_name: staging-database
    status: terminated
    group: staging
    cloud: gcp
    public_ip: 34.66.108.223
    services:
      postgresql:
        port: 5432
        protocol: postgresql

# Ansible defaults
ansible_defaults:
  ansible_user: root
  ansible_ssh_common_args: -o StrictHostKeyChecking=accept-new
