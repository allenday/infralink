# Example Infrastructure Registry
#
# Design principles:
# - UUID is the primary key (immutable identity)
# - Roles define expected services (contracts)
# - Services are first-class objects with port/protocol/exposure
# - Provider-specific metadata in generic bucket
# - Health derived from prometheus scrape success

hosts:
  # Database server - declares roles, services derived
  d1b9e5d5-36b0-459d-a556-96622811fbd5:
    canonical_name: prod-database
    status: active
    group: production
    cloud: hetzner-cloud
    tailscale_ip: 100.78.109.111
    tailscale_name: prod-database
    public_ip: 91.99.122.86
    use_exit_node: false
    dns_hostnames:
      - db.internal.example.com

    # Roles this host fulfills (services derived from role definitions)
    roles:
      - postgresql
      - redis
      - mariadb
      - node-exporter

    # Explicit services (one-offs not covered by roles)
    services:
      postgres-exporter:
        port: 9187
        protocol: http
        exposure: internal
      redis-exporter:
        port: 9121
        protocol: http
        exposure: internal

    provider_metadata:
      hcloud_project: my-project

    observability:
      ready: true
      managed_services:
        - node-exporter
        - postgres-exporter
        - redis-exporter

  # Application server 1
  fa2b9872-d94c-4b20-a73a-57a205560769:
    canonical_name: prod-app-1
    status: active
    group: production
    cloud: hetzner-robot
    tailscale_ip: 100.69.66.115
    tailscale_name: prod-app-1
    public_ip: 162.55.23.32
    public_ip_secondary: 162.55.23.33
    use_exit_node: false
    dns_hostnames:
      - app1.example.com
      - www.example.com

    roles:
      - nginx
      - app-worker
      - node-exporter
      - cadvisor
    role_overrides:
      app-worker:
        concurrency: 10

    provider_metadata:
      robot_id: 2440889
      robot_product: AX162-R
      robot_dc: FSN1-DC19

    mounts:
      storagebox0:
        type: cifs
        source: //u1234.your-storagebox.de/backup
        target: /mnt/storagebox0

    observability:
      ready: true
      managed_services:
        - node-exporter
        - cadvisor

  # Application server 2
  b1a554f8-76ed-4d98-91bb-f0fbfc2818d1:
    canonical_name: prod-app-2
    status: active
    group: production
    cloud: hetzner-robot
    tailscale_ip: 100.82.220.106
    tailscale_name: prod-app-2
    public_ip: 78.46.72.53
    use_exit_node: false

    roles:
      - nginx
      - app-worker
      - node-exporter
      - cadvisor
    role_overrides:
      app-worker:
        concurrency: 10

    mounts:
      storagebox0:
        type: cifs
        source: //u1234.your-storagebox.de/backup
        target: /mnt/storagebox0

    observability:
      ready: true
      managed_services:
        - node-exporter
        - cadvisor

  # Monitoring server
  97da6b29-9b36-4d78-999d-739e6529f17d:
    canonical_name: monitoring-bastion
    status: active
    group: infrastructure
    cloud: hetzner-cloud
    tailscale_ip: 100.91.20.46
    tailscale_name: monitoring-bastion
    public_ip: 91.99.181.74
    use_exit_node: false

    roles:
      - prometheus
      - grafana
      - otel-collector
      - node-exporter
      - tailscale-exit-node

    provider_metadata:
      hcloud_project: my-project

    observability:
      ready: true
      managed_services:
        - node-exporter

  # Staging database (terminated)
  e1a2b3c4-d5e6-4f7a-8b9c-0d1e2f3a4b5c:
    canonical_name: staging-database
    status: terminated
    group: staging
    cloud: gcp
    public_ip: 34.66.108.223

    roles:
      - postgresql

    provider_metadata:
      gcp_project: my-staging
      gcp_zone: us-central1-a

# Ansible defaults
ansible_defaults:
  ansible_user: root
  ansible_ssh_common_args: -o StrictHostKeyChecking=accept-new
